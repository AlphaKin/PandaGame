{"version":3,"sources":["DrawLine.js"],"names":["DrawLine","cc","Class","extends","Component","properties","line_obj","Node","pigment_store","_gap","_pigmentManager","onLoad","_lastPos","v2","_widthoff","view","getVisibleSize","width","_heightoff","height","node","on","EventType","TOUCH_MOVE","onTouchMove","TOUCH_START","onTouchStart","TOUCH_END","onTouchEnd","start","getComponent","setPigmentType","event","newPos","getLocation","distance","sub","mag","gap","num","parseInt","dx","x","dy","y","dir","angle","signAngle","degree","Math","PI","tmpPos","deltaX","deltaY","i","makeNewPigment","random","clearPigments","removeAllChildren","locate","newPigment","createPigment","setPosition","convertToNodeSpaceAR","addChild","update","dt","module","exports"],"mappings":"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","file":"DrawLine.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nvar DrawLine = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        line_obj: cc.Node,\n        pigment_store: 0,\n        _gap: 30,\n        _pigmentManager: null\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this._lastPos = cc.v2(0, 0);\n        this._widthoff = cc.view.getVisibleSize().width/2;\n        this._heightoff = cc.view.getVisibleSize().height/2;\n\n        //事件监听\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n\n    },\n\n    start () {\n        this._pigmentManager = this.line_obj.getComponent(\"PigmentManager\");\n        this._pigmentManager.setPigmentType(2);\n    },\n\n    onTouchMove(event){\n        let newPos = event.getLocation();\n        let distance = newPos.sub(this._lastPos).mag();\n        let gap = this._pigmentManager.gap;\n        let num = parseInt(distance / gap);\n        if(distance > gap){\n            let dx = newPos.x - this._lastPos.x;\n            let dy = newPos.y - this._lastPos.y;\n            let dir = cc.v2(dx,dy);\n            let angle = dir.signAngle(cc.v2(1,0));\n            let degree = angle / Math.PI * 180;\n            if(this.pigment_store > 0){\n                let tmpPos = this._lastPos;\n                let deltaX =  (newPos.x - this._lastPos.x) / distance * gap;\n                let deltaY =  (newPos.y - this._lastPos.y) / distance * gap;\n                for(let i=0; i<num; ++i){\n                    tmpPos.x += deltaX;\n                    tmpPos.y += deltaY;\n                    this.makeNewPigment(tmpPos, Math.random()*360 - 180);\n                    this.pigment_store--;\n                }\n                this._lastPos = tmpPos;\n            }\n        }\n    },\n\n    onTouchStart(event){\n        let newPos = event.getLocation();\n        this.clearPigments();\n        this.pigment_store = 100;\n        this.makeNewPigment(newPos, Math.random()*360 - 180);\n        this._lastPos = newPos;\n    },\n\n    onTouchEnd(event){ },\n\n    clearPigments(){\n        this.line_obj.removeAllChildren();\n    },\n\n    makeNewPigment(locate, degree){\n        let newPigment = this._pigmentManager.createPigment(locate, degree);\n        newPigment.setPosition(this.node.convertToNodeSpaceAR(locate));\n        \n        // console.log(newPigment.getPosition());\n        this.line_obj.addChild(newPigment);\n        newPigment.angle = -(degree-90);\n    },\n    update (dt) {\n    },\n});\n\nmodule.exports = DrawLine;"]}