{"version":3,"sources":["gameManager.js"],"names":["com","require","global","cc","Class","extends","Component","properties","blocks","Prefab","arch","btn_setting","Node","btn_pause","ui_setting","_nowConfig","onLoad","that","on","EventType","TOUCH_END","event","console","log","node","instantiate","find","addChild","size","winSize","setPosition","v2","width","height","gamePause","start","initGame","i","MAP_WIDTH","MAP","Array","MAP_HEIGHT","MAP_OBJ","root","destroyAllChildren","j","loadBlocks","clearMap","generatePostion","Math","floor","random","director","pause","gameResume","resume","nextLevel","nowLevel","level_config","length","alert","blocksRoot","level_ui","getComponent","updateLevel","cnt","pos","block","bp","x","y","spt_name","block_table","update","dt","Label","string","score"],"mappings":"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","file":"gameManager.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nvar com = require('common');\r\nvar global = require('global');\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        blocks: [cc.Prefab],\r\n        arch: cc.Prefab,\r\n        btn_setting: cc.Node,\r\n        btn_pause: cc.Node,\r\n        ui_setting: cc.Prefab,\r\n        _nowConfig: null\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n\r\n\r\n    onLoad () {\r\n        let that = this;\r\n        this.btn_setting.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            console.log(\"点击了设置\");\r\n            let node = cc.instantiate(that.ui_setting);\r\n            cc.find(\"Canvas/blocks\").addChild(node);\r\n            let size = cc.winSize;\r\n            node.setPosition(cc.v2(size.width/2, size.height/2));\r\n            that.gamePause();\r\n        })\r\n    },\r\n\r\n    start () {\r\n        this.initGame();\r\n    },\r\n\r\n    initGame(){\r\n        for(let i=0; i<com.MAP_WIDTH; ++i){\r\n            com.MAP[i] = new Array(com.MAP_HEIGHT);\r\n            com.MAP_OBJ[i] = new Array(com.MAP_HEIGHT);\r\n        }\r\n        let root = cc.find(\"Canvas/blocks\");\r\n        root.destroyAllChildren();\r\n        for(let i=0; i<com.MAP_WIDTH; ++i){\r\n            for(let j=0; j<com.MAP_HEIGHT; ++j){\r\n                com.MAP[i][j] = -1;\r\n                com.MAP_OBJ[i][j] = null;\r\n                // let block = cc.instantiate(this.arch);\r\n                // root.addChild(block);\r\n                // block.setPosition(cc.v2(i * 105 + 63, j * 105 + 70));\r\n            }\r\n        }\r\n        this.loadBlocks();\r\n    },\r\n\r\n    clearMap(){\r\n        for(let i=0; i<com.MAP_WIDTH; ++i){\r\n            for(let j=0; j<com.MAP_HEIGHT; ++j){\r\n                com.MAP[i][j] = -1;\r\n            }\r\n        }\r\n    },\r\n\r\n    generatePostion(){\r\n        return [\r\n            Math.floor(Math.random() * (com.MAP_WIDTH)),\r\n            Math.floor(Math.random() * (com.MAP_HEIGHT))\r\n        ];\r\n    },\r\n\r\n    gamePause(){\r\n        cc.director.pause();\r\n    },\r\n\r\n    gameResume(){\r\n        cc.director.resume();\r\n    },\r\n\r\n    nextLevel(){\r\n        if(com.nowLevel == com.level_config.length - 1){\r\n            alert(\"All pass\");\r\n        }else{\r\n            ++com.nowLevel;\r\n            this.initGame();\r\n            this.gameResume();\r\n        }\r\n    },\r\n\r\n    loadBlocks(){\r\n        this.clearMap();\r\n        this._nowConfig = com.level_config[com.nowLevel];\r\n        let blocksRoot = cc.find(\"Canvas/blocks\");\r\n        let level_ui = cc.find(\"Canvas/title/ui_level\").getComponent(\"levelUI\");\r\n        level_ui.updateLevel();\r\n        for(let i=0; i<this._nowConfig.length; ++i){\r\n            let cnt = 0;\r\n            while(cnt < this._nowConfig[i]){\r\n                let pos;\r\n                do{\r\n                    pos = this.generatePostion();\r\n                    // console.log(pos[0] + \" \" + pos[1]);\r\n                }while(com.MAP[pos[0]][pos[1]] != -1);\r\n                // console.log(\"OK - \" + i + \" ------------------\");\r\n                com.MAP[pos[0]][pos[1]] = i;\r\n\r\n                let block = cc.instantiate(this.blocks[i]);\r\n                // console.log(block);\r\n                let bp = block.getComponent(\"position\");\r\n                bp.x = pos[0]; bp.y = pos[1];\r\n                bp.spt_name = com.block_table[i];\r\n                com.MAP_OBJ[pos[0]][pos[1]] = block;\r\n                block.setPosition(cc.v2(pos[0] * 105 + 63, pos[1] * 105 + 70));\r\n                blocksRoot.addChild(block);\r\n                ++cnt;\r\n            }\r\n        }\r\n    },\r\n    update (dt) {\r\n        cc.find(\"Canvas/title/score_ui\").getComponent(cc.Label).string = com.score;\r\n    },\r\n});\r\n"]}